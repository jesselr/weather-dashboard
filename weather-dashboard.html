<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Weather Dashboard - Pella, IA</title>
<style>
  :root {
    --bg: #111;
    --panel: #181818;
    --text-main: #ffffff;
    --text-muted: #aaaaaa;
    --accent: #3fa9ff;
    --danger: #ff6b6b;
  }

  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    color: var(--text-main);
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  /* Radar */
  #radar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 72%;
    border: 0;
  }

  /* Current conditions bar */
  #current {
    position: absolute;
    top: 72%;
    left: 0;
    width: 100%;
    height: 13%;
    background: var(--panel);
    display: flex;
    justify-content: space-around;
    align-items: center;
    font-size: 1.6rem;
    padding: 0 2rem;
  }

  #current > div {
    text-align: center;
    min-width: 18%;
  }

  .label {
    font-size: 1.0rem;
    color: var(--text-muted);
    margin-bottom: 0.3rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Forecast strip */
  #forecast-strip {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 15%;
    background: #151515;
    display: flex;
    justify-content: space-evenly;
    align-items: stretch;
    padding: 0.5rem 1rem 0.8rem;
    gap: 0.75rem;
    overflow: hidden;
  }

  .forecast-day {
    flex: 1;
    background: #1f1f1f;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 0.4rem 0.3rem;
  }

  .forecast-day:nth-child(1) {
    border: 2px solid var(--accent);
  }

  .forecast-day .dow {
    font-size: 1.0rem;
    font-weight: bold;
    margin-bottom: 0.25rem;
  }

  .forecast-day .icon {
    font-size: 1.6rem;
    margin-bottom: 0.15rem;
  }

  .forecast-day .summary {
    font-size: 0.9rem;
    text-align: center;
    line-height: 1.1;
    color: var(--text-muted);
    min-height: 2.1em;
  }

  .forecast-day .temps {
    font-size: 0.95rem;
    margin-top: 0.2rem;
  }

  .forecast-day .high {
    color: var(--accent);
    font-weight: bold;
  }

  .forecast-day .low {
    color: var(--text-muted);
  }

  .forecast-day .high::after,
  .forecast-day .low::after {
    content: "Â°F";
    font-size: 0.8em;
    margin-left: 1px;
  }
</style>
</head>
<body>

<!-- Radar -->
<iframe id="radar"
  src="https://embed.windy.com/embed2.html?lat=41.41&lon=-92.91&zoom=8&level=surface&overlay=radar"
  frameborder="0">
</iframe>

<!-- Current Conditions -->
<div id="current">
  <div>
    <div class="label">Temp</div>
    <span id="temp">--Â°F</span>
  </div>
  <div>
    <div class="label">Feels Like</div>
    <span id="feels">--Â°F</span>
  </div>
  <div>
    <div class="label">Humidity</div>
    <span id="humidity">--%</span>
  </div>
  <div>
    <div class="label">Wind</div>
    <span id="wind">-- mph</span>
  </div>
</div>

<!-- TV-style forecast strip -->
<div id="forecast-strip">
  <!-- Filled by JS -->
</div>

<script>
/* ---------- NWS current conditions (same idea as before) ---------- */
async function updateConditions() {
  try {
    const pointUrl = "https://api.weather.gov/points/41.4083,-92.9165";
    const point = await fetch(pointUrl).then(r => r.json());

    const obsStationsUrl = point.properties.observationStations;
    const stations = await fetch(obsStationsUrl).then(r => r.json());
    const stationId = stations.features[0].id + "/observations/latest";

    const obs = await fetch(stationId).then(r => r.json());
    const props = obs.properties;

    const tempC = props.temperature && props.temperature.value;
    const windChillC = props.windChill && props.windChill.value;
    const humidityVal = props.relativeHumidity && props.relativeHumidity.value;
    const windSpeedKmh = props.windSpeed && props.windSpeed.value;

    const tempF = (tempC !== null && tempC !== undefined)
      ? Math.round(tempC * 9/5 + 32)
      : null;

    const feelsF = (windChillC !== null && windChillC !== undefined)
      ? Math.round(windChillC * 9/5 + 32)
      : tempF;

    const humidity = (humidityVal !== null && humidityVal !== undefined)
      ? Math.round(humidityVal)
      : null;

    const windMph = (windSpeedKmh !== null && windSpeedKmh !== undefined)
      ? Math.round(windSpeedKmh * 0.621371)
      : null;

    document.getElementById("temp").innerText =
      (tempF !== null ? tempF + "Â°F" : "--Â°F");

    document.getElementById("feels").innerText =
      (feelsF !== null ? feelsF + "Â°F" : "--Â°F");

    document.getElementById("humidity").innerText =
      (humidity !== null ? humidity + "%" : "--%");

    document.getElementById("wind").innerText =
      (windMph !== null ? windMph + " mph" : "-- mph");

  } catch (e) {
    console.log("Weather update failed", e);
  }
}

/* ---------- Open-Meteo 5-day TV strip forecast ---------- */
function weatherIconAndSummary(code) {
  // Simple mapping of Open-Meteo weather codes to emoji + label
  // https://open-meteo.com/en/docs
  if (code === 0) return { icon: "â˜€ï¸", text: "Clear" };
  if (code === 1 || code === 2) return { icon: "ðŸŒ¤ï¸", text: "Mostly Sunny" };
  if (code === 3) return { icon: "â˜ï¸", text: "Cloudy" };
  if (code === 45 || code === 48) return { icon: "ðŸŒ«ï¸", text: "Fog" };
  if ([51, 53, 55, 56, 57].includes(code)) return { icon: "ðŸŒ¦ï¸", text: "Drizzle" };
  if ([61, 63, 65].includes(code)) return { icon: "ðŸŒ§ï¸", text: "Rain" };
  if ([66, 67].includes(code)) return { icon: "ðŸŒ§ï¸", text: "Freezing Rain" };
  if ([71, 73, 75].includes(code)) return { icon: "â„ï¸", text: "Snow" };
  if ([77].includes(code)) return { icon: "â„ï¸", text: "Snow Grains" };
  if ([80, 81, 82].includes(code)) return { icon: "ðŸŒ¦ï¸", text: "Showers" };
  if ([85, 86].includes(code)) return { icon: "â„ï¸", text: "Snow Showers" };
  if ([95].includes(code)) return { icon: "â›ˆï¸", text: "Thunderstorm" };
  if ([96, 99].includes(code)) return { icon: "â›ˆï¸", text: "Storm" };
  return { icon: "â”", text: "â€“" };
}

function formatDow(dateStr) {
  const d = new Date(dateStr + "T12:00:00");
  const opts = { weekday: "short" };
  return d.toLocaleDateString("en-US", opts);
}

async function updateForecastStrip() {
  try {
    const url =
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=41.4083&longitude=-92.9165" +
      "&daily=weathercode,temperature_2m_max,temperature_2m_min" +
      "&temperature_unit=fahrenheit" +
      "&timezone=America%2FChicago";


    const data = await fetch(url).then(r => r.json());
    const daily = data.daily;

    const strip = document.getElementById("forecast-strip");
    strip.innerHTML = "";

    const daysToShow = Math.min(5, daily.time.length);
    for (let i = 0; i < daysToShow; i++) {
      const date = daily.time[i];
      const code = daily.weathercode[i];
      const tMax = Math.round(daily.temperature_2m_max[i]);
      const tMin = Math.round(daily.temperature_2m_min[i]);

      const { icon, text } = weatherIconAndSummary(code);
      const dow = i === 0 ? "Today" : formatDow(date);

      const col = document.createElement("div");
      col.className = "forecast-day";

      col.innerHTML = `
        <div class="dow">${dow}</div>
        <div class="icon">${icon}</div>
        <div class="summary">${text}</div>
        <div class="temps">
          <span class="high">${tMax}</span> /
          <span class="low">${tMin}</span>
        </div>
      `;

      strip.appendChild(col);
    }
  } catch (e) {
    console.log("Forecast update failed", e);
  }
}

/* ---------- Init loops ---------- */
updateConditions();
setInterval(updateConditions, 5 * 60 * 1000); // every 5 minutes

updateForecastStrip();
setInterval(updateForecastStrip, 60 * 60 * 1000); // every hour
</script>

</body>
</html>



