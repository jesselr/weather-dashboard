<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weather Dashboard ‚Äì Pella, IA</title>

<style>
:root {
  --bg: #111;
  --panel: #181818;
  --panel-dark: #151515;
  --text-main: #ffffff;
  --text-muted: #aaaaaa;
  --accent: #3fa9ff;
}

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: var(--bg);
  color: var(--text-main);
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

/* ===== GRID LAYOUT (Fire Stick safe) ===== */
body {
  display: grid;
  grid-template-rows:
    1fr        /* radar (fills remaining space) */
    80px       /* current conditions */
    120px;     /* forecast strip */
}

/* ===== RADAR ===== */
#radar {
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}

/* ===== CURRENT CONDITIONS ===== */
#current {
  background: var(--panel);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 0 1rem;
  font-size: 1.25rem;
}

#current > div {
  text-align: center;
  min-width: 20%;
}

.label {
  font-size: 0.8rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 0.15rem;
}

/* ===== FORECAST STRIP ===== */
#forecast-strip {
  background: var(--panel-dark);
  display: flex;
  justify-content: space-evenly;
  align-items: stretch;
  padding: 0.25rem 0.5rem;
  gap: 0.4rem;
  overflow: hidden;
}

.forecast-day {
  flex: 1;
  background: #1f1f1f;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-around;
  padding: 0.25rem 0.2rem;
}

.forecast-day:first-child {
  border: 2px solid var(--accent);
}

.forecast-day .dow {
  font-size: 0.75rem;
  font-weight: bold;
}

.forecast-day .icon {
  font-size: 1.2rem;
  line-height: 1;
}

.forecast-day .summary {
  font-size: 0.65rem;
  line-height: 1.05;
  color: var(--text-muted);
  text-align: center;
}

.forecast-day .temps {
  font-size: 0.8rem;
  line-height: 1;
}

.forecast-day .high {
  color: var(--accent);
  font-weight: bold;
}

.forecast-day .low {
  color: var(--text-muted);
}

.forecast-day .high::after,
.forecast-day .low::after {
  content: "¬∞F";
  font-size: 0.7em;
  margin-left: 1px;
}
</style>
</head>

<body>

<!-- ===== RADAR ===== -->
<iframe
  id="radar"
  src="https://embed.windy.com/embed2.html?lat=41.41&lon=-92.91&zoom=8&level=surface&overlay=radar&product=radar&calendar=now"
  frameborder="0"
  scrolling="no">
</iframe>


<!-- ===== CURRENT CONDITIONS ===== -->
<div id="current">
  <div>
    <div class="label">Temp</div>
    <span id="temp">--¬∞F</span>
  </div>
  <div>
    <div class="label">Feels Like</div>
    <span id="feels">--¬∞F</span>
  </div>
  <div>
    <div class="label">Humidity</div>
    <span id="humidity">--%</span>
  </div>
  <div>
    <div class="label">Wind</div>
    <span id="wind">-- mph</span>
  </div>
</div>

<!-- ===== FORECAST STRIP ===== -->
<div id="forecast-strip"></div>

<script>
/* ===== NWS CURRENT CONDITIONS ===== */
async function updateConditions() {
  try {
    const point = await fetch(
      "https://api.weather.gov/points/41.4083,-92.9165"
    ).then(r => r.json());

    const stations = await fetch(
      point.properties.observationStations
    ).then(r => r.json());

    const obs = await fetch(
      stations.features[0].id + "/observations/latest"
    ).then(r => r.json());

    const p = obs.properties;

    const tempF = p.temperature?.value != null
      ? Math.round(p.temperature.value * 9/5 + 32)
      : null;

    const feelsF = p.windChill?.value != null
      ? Math.round(p.windChill.value * 9/5 + 32)
      : tempF;

    const humidity = p.relativeHumidity?.value != null
      ? Math.round(p.relativeHumidity.value)
      : null;

    const windMph = p.windSpeed?.value != null
      ? Math.round(p.windSpeed.value * 0.621371)
      : null;

    document.getElementById("temp").innerText =
      tempF != null ? tempF + "¬∞F" : "--¬∞F";

    document.getElementById("feels").innerText =
      feelsF != null ? feelsF + "¬∞F" : "--¬∞F";

    document.getElementById("humidity").innerText =
      humidity != null ? humidity + "%" : "--%";

    document.getElementById("wind").innerText =
      windMph != null ? windMph + " mph" : "-- mph";
  } catch (e) {
    console.log("Current conditions error", e);
  }
}

/* ===== OPEN-METEO FORECAST ===== */
function iconForCode(code) {
  if (code === 0) return ["‚òÄÔ∏è", "Clear"];
  if (code <= 2) return ["üå§Ô∏è", "Mostly Sunny"];
  if (code === 3) return ["‚òÅÔ∏è", "Cloudy"];
  if (code <= 48) return ["üå´Ô∏è", "Fog"];
  if (code <= 57) return ["üå¶Ô∏è", "Drizzle"];
  if (code <= 67) return ["üåßÔ∏è", "Rain"];
  if (code <= 77) return ["‚ùÑÔ∏è", "Snow"];
  if (code <= 82) return ["üå¶Ô∏è", "Showers"];
  if (code >= 95) return ["‚õàÔ∏è", "Storm"];
  return ["‚ùî", ""];
}

function dow(dateStr) {
  return new Date(dateStr + "T12:00").toLocaleDateString("en-US", { weekday: "short" });
}

async function updateForecast() {
  try {
    const data = await fetch(
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=41.4083&longitude=-92.9165" +
      "&daily=weathercode,temperature_2m_max,temperature_2m_min" +
      "&temperature_unit=fahrenheit" +
      "&timezone=America%2FChicago"
    ).then(r => r.json());

    const strip = document.getElementById("forecast-strip");
    strip.innerHTML = "";

    for (let i = 0; i < 5; i++) {
      const [icon, text] = iconForCode(data.daily.weathercode[i]);
      const day = i === 0 ? "Today" : dow(data.daily.time[i]);

      strip.innerHTML += `
        <div class="forecast-day">
          <div class="dow">${day}</div>
          <div class="icon">${icon}</div>
          <div class="summary">${text}</div>
          <div class="temps">
            <span class="high">${Math.round(data.daily.temperature_2m_max[i])}</span> /
            <span class="low">${Math.round(data.daily.temperature_2m_min[i])}</span>
          </div>
        </div>`;
    }
  } catch (e) {
    console.log("Forecast error", e);
  }
}

/* ===== INIT ===== */
updateConditions();
updateForecast();

setInterval(updateConditions, 5 * 60 * 1000);
setInterval(updateForecast, 60 * 60 * 1000);
</script>

</body>
</html>



